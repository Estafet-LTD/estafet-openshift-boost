---
- name: Install Jaeger Operator Role
  shell: "oc create -n {{ project }} -f https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/role.yaml"
  register: command_result
  failed_when: "'exists' not in command_result.stderr and command_result.rc != 0"
  changed_when: "'exists' not in command_result.stderr"
  tags:
    - openshift
    - opentracing
    - jaeger           

- name: Install Jaeger Operator Role Binding
  shell: "oc create -n {{ project }} -f https://raw.githubusercontent.com/jaegertracing/jaeger-operator/master/deploy/role_binding.yaml"
  register: command_result
  failed_when: "'exists' not in command_result.stderr and command_result.rc != 0"
  changed_when: "'exists' not in command_result.stderr"
  tags:
    - openshift
    - opentracing
    - jaeger   

- name: Install Jaeger
  shell: "oc apply -f {{ actions }}/boostcd.jaeger_setup/files/jaeger-agent.yml -n {{ project }}"
  register: command_result
  failed_when: "'exists' not in command_result.stderr and command_result.rc != 0"
  changed_when: "'exists' not in command_result.stderr"
  tags:
    - openshift
    - opentracing
    - jaeger             

- name: Sleep for 10 seconds and then check for deployment
  wait_for:
    delay: 10
    timeout: 0

- name: Wait for the jaeger operator to become available
  shell : "oc rollout status deployment jaeger-agent -n {{ project }}"
  register: command_result
  failed_when: "'exists' not in command_result.stderr and command_result.rc != 0"
  changed_when: "'exists' not in command_result.stderr"
  tags:
    - openshift  

    